<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>é•·å°¾æ™¯ æ¥½æ›²ç¥ç±¤ï½œæ¡œè¯æ°´</title>
  <link rel="icon" href="../images/favicon.ico" sizes="any">
  <style>
    /* ===== åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« ===== */
    *, *::before, *::after { box-sizing: border-box; }
    :root{ --fg:#222; --muted:#4b5563; --accent:#625DA1; --bg:#fff; --border:#e5e7eb; --panel:#f8f8ff; }
    
    html, body {
        margin: 0; padding: 0;
        background: var(--bg); color: var(--fg);
        font-family: system-ui, -apple-system, sans-serif;
        width: 100%; overflow-x: hidden;
    }

    /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
    header {
        position: sticky; top: 0;
        background: linear-gradient(90deg, #C24DAED9, #625DA1D9);
        backdrop-filter: saturate(1.2) blur(6px);
        -webkit-backdrop-filter: saturate(1.2) blur(6px); /* Safariç”¨ã«è¿½åŠ  */
        border-bottom: 1px solid var(--border);
        z-index: 100;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    header .wrap {
        max-width: 1200px; margin-inline: auto; padding: 12px 16px;
        display: flex; justify-content: space-between; align-items: center;
    }
    .brand { font-weight: 800; color: #fff; text-decoration: none; font-size: 20px; display: flex; align-items: center; gap: 10px; }
    .nav-links { display: flex; gap: 10px; }
    .nav-links a { 
        font-size: 13px; font-weight: 700; color: #fff; text-decoration: none; padding: 6px 14px;
        position: relative; z-index: 1;
    }
    .nav-links a::before {
        content: ""; position: absolute; inset: 0; z-index: -1;
        transform: skewX(-20deg); border-radius: 4px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.15); transition: 0.2s;
    }
    .nav-links a.link-video::before { background: #B43246; }
    .nav-links a.link-song::before { background: #4DD7E3; }

    /* â–¼â–¼â–¼ èƒŒæ™¯ç”»åƒã®è¨­å®š â–¼â–¼â–¼ */
    body{
      background-image: url("images/washipattern.PNG");
      background-image: image-set(
        url("../images/washipattern.webp") type("image/webp") 1x,
        url("../images/washipattern@2x.webp") type("image/webp") 2x
      );
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
      background-attachment: fixed;
      position: relative; /* é‡ãªã‚Šé †ã®åŸºæº–ã«ã™ã‚‹ */
    }

    /* â–¼â–¼â–¼ ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼ˆã¼ã‹ã—ï¼‹ç™½ï¼‰ã®ä¿®æ­£ç‰ˆ â–¼â–¼â–¼ */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      /* ç™½ã®æ¿ƒã•ï¼šã¼ã‹ã—ã‚’è¦‹ãˆã‚„ã™ãã™ã‚‹ãŸã‚0.8â†’0.7ã«å°‘ã—ä¸‹ã’ã¦èª¿æ•´ï¼ˆãŠå¥½ã¿ã§0.8ã«æˆ»ã—ã¦ãã ã•ã„ï¼‰ */
      background: rgba(255, 255, 255, 0.7); 
      /* Safariå¯¾å¿œã®è¨˜è¿°ã‚’è¿½åŠ  */
      -webkit-backdrop-filter: blur(5px);
      backdrop-filter: blur(5px);
      /* é‡è¦ï¼š-1ã ã¨ç”»åƒã®è£ã«è¡Œãã“ã¨ãŒã‚ã‚‹ã®ã§ 0 ã«ã—ã¦ç”»åƒã®ä¸Šã«ä¹—ã›ã‚‹ */
      z-index: 0; 
      pointer-events: none; /* ã‚¯ãƒªãƒƒã‚¯ã‚’é‚ªé­”ã—ãªã„ã‚ˆã†ã«ã™ã‚‹ */
    }

    /* ãŠã¿ãã˜ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ */
    .omikuji-container {
        position: relative; /* é‡è¦ï¼šã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚ˆã‚Šä¸Šã«è¡¨ç¤ºã•ã›ã‚‹ */
        z-index: 1;         /* é‡è¦ï¼šã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤(0)ã‚ˆã‚Šä¸Šã®éšå±¤ã«ã™ã‚‹ */
        
        max-width: 600px;
        margin: 40px auto;
        padding: 20px;
        text-align: center;
        min-height: 80vh;
        display: flex; flex-direction: column; align-items: center;
    }
    
    .omikuji-title {
        font-size: 24px; margin-bottom: 30px; color: var(--accent);
        font-weight: 800;
    }

    /* ã‚¬ãƒ©ã‚¬ãƒ©ãƒœã‚¿ãƒ³ */
    .draw-btn {
        appearance: none; border: 0; cursor: pointer;
        background:linear-gradient(90deg, #C24DAED9, #625DA1D9);
        color: #fff; font-size: 18px; font-weight: 800;
        padding: 20px 40px; border-radius: 50px;
        box-shadow: 0 10px 25px rgba(255, 107, 107, 0.4);
        transition: transform 0.1s, box-shadow 0.1s;
        display: flex; flex-direction: column; align-items: center; gap: 5px;
    }
    .draw-btn:active { transform: scale(0.95); box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4); }
    .draw-btn span { font-size: 12px; opacity: 0.9; font-weight: normal; }

    /* çµæœè¡¨ç¤ºã‚«ãƒ¼ãƒ‰ */
    .result-card {
        margin-top: 40px; width: 100%;
        background: #fff; border: 1px solid var(--border);
        border-radius: 16px; overflow: hidden;
        box-shadow: 0 10px 40px rgba(98, 93, 161, 0.15);
        opacity: 0; transform: translateY(20px);
        transition: 0.5s cubic-bezier(0.22, 1, 0.36, 1);
        display: none; /* åˆæœŸéè¡¨ç¤º */
    }
    .result-card.show { display: block; opacity: 1; transform: translateY(0); }

    .result-header {
        background: var(--panel); padding: 15px;
        border-bottom: 1px solid var(--border);
        font-size: 12px; color: var(--muted); letter-spacing: 0.1em;
    }
    .result-body { padding: 20px; }
    .song-name { font-size: 20px; font-weight: 800; color: #333; margin-bottom: 8px; line-height: 1.4; }
    .artist-name { font-size: 14px; color: var(--muted); margin-bottom: 20px; }
    
    .video-frame {
        width: 100%; aspect-ratio: 16/9; background: #000;
        border-radius: 8px; overflow: hidden; margin-bottom: 15px;
    }
    .video-frame iframe { width: 100%; height: 100%; border: 0; }

    .video-meta {
        font-size: 12px; color: #666; text-align: left;
        background: #f9fafb; padding: 10px; border-radius: 8px;
    }

    .share-area { margin-top: 20px; }
    .tweet-btn {
        display: inline-block; text-decoration: none;
        background: #1DA1F2; color: #fff; padding: 10px 20px;
        border-radius: 99px; font-weight: 700; font-size: 14px;
    }

  </style>
</head>
<body>

<header>
  <div class="wrap">
    <a href="../index.html" class="brand"><span>æ¡œè¯æ°´</span></a>
    <nav class="nav-links">
      <a href="../archives/index.html" class="link-video">å‹•ç”»ã‚’æ¢ã™</a>
      <a href="./index.html" class="link-song">æ›²ã‚’æ¢ã™</a>
    </nav>
  </div>
</header>

<main class="omikuji-container">
  <h1 class="omikuji-title">æ¥½æ›²ç¥ç±¤</h1>
  <p style="margin-bottom: 30px; font-size: 14px; line-height: 1.8;">
    é•·å°¾æ™¯ãŒæ­Œã£ãŸæ•°å¤šã®æ›²ã®ä¸­ã‹ã‚‰ã€<br>
    ä»Šæ—¥ã®ã‚ãªãŸã«ã´ã£ãŸã‚Šã®ä¸€æ›²ã‚’ææ¡ˆã—ã¾ã™ã€‚
  </p>

  <button id="drawBtn" class="draw-btn">
    ç¥ç±¤ã‚’å¼•ã
    <span>Click to Play</span>
  </button>

  <div id="resultCard" class="result-card">
    <div class="result-header">TODAY'S SONG</div>
    <div class="result-body">
      <div id="resSong" class="song-name"></div>
      <div id="resArtist" class="artist-name"></div>
      
      <div class="video-frame">
        <iframe id="ytFrame" src="" allow="autoplay; encrypted-media" allowfullscreen></iframe>
      </div>
      
      <div class="video-meta">
        åéŒ²å‹•ç”»ï¼š<span id="resVideoTitle"></span><br>
        æ—¥ä»˜ï¼š<span id="resDate"></span>
      </div>

      <div class="share-area">
        <a id="tweetBtn" href="#" target="_blank" class="tweet-btn">ğ• ã§çµæœã‚’ãƒã‚¹ãƒˆã™ã‚‹</a>
      </div>
    </div>
  </div>
</main>

<script>
  let allSongs = [];

  // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
  fetch('videos.json')
    .then(r => r.json())
    .then(data => {
      // ãƒ‡ãƒ¼ã‚¿ã‚’ã€Œæ›²å˜ä½ã€ã«ãƒ•ãƒ©ãƒƒãƒˆåŒ–ã™ã‚‹
      data.forEach(v => {
        if(!v.songs) return;
        v.songs.forEach(s => {
          allSongs.push({
            song: s.title || s.song,
            artist: s.artist || s.singer || 'ä¸æ˜',
            start: s.start || s.time || 0,
            videoTitle: v.title,
            videoId: v.youtubeId,
            date: v.date
          });
        });
      });
      console.log(`Loaded ${allSongs.length} songs.`);
    })
    .catch(e => console.error(e));

  // ãŠã¿ãã˜ãƒœã‚¿ãƒ³å‡¦ç†
  const btn = document.getElementById('drawBtn');
  const card = document.getElementById('resultCard');
  const frame = document.getElementById('ytFrame');

  btn.addEventListener('click', () => {
    if(allSongs.length === 0) return alert("ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­ã§ã™...");

    // ãƒ©ãƒ³ãƒ€ãƒ ã«1æ›²é¸ã¶
    const pick = allSongs[Math.floor(Math.random() * allSongs.length)];

    // ç§’æ•°å¤‰æ›å‡¦ç†
    let startSec = 0;
    if(typeof pick.start === 'number') {
        startSec = pick.start;
    } else {
        const p = String(pick.start).split(':').map(Number);
        if(p.length===3) startSec = p[0]*3600 + p[1]*60 + p[2];
        else if(p.length===2) startSec = p[0]*60 + p[1];
    }

    // è¡¨ç¤ºæ›´æ–°
    document.getElementById('resSong').textContent = pick.song;
    document.getElementById('resArtist').textContent = pick.artist;
    document.getElementById('resVideoTitle').textContent = pick.videoTitle;
    document.getElementById('resDate').textContent = pick.date;

    // YouTubeåŸ‹ã‚è¾¼ã¿æ›´æ–° (è‡ªå‹•å†ç”ŸON)
    frame.src = `https://www.youtube.com/embed/${pick.videoId}?start=${startSec}&autoplay=1&rel=0&modestbranding=1&playsinline=1`;

    // ãƒ„ã‚¤ãƒ¼ãƒˆãƒœã‚¿ãƒ³æ›´æ–°
    const text = `ä»Šæ—¥ã®é•·å°¾æ™¯ãŠã™ã™ã‚æ›²ã¯ã€Œ${pick.song} / ${pick.artist}ã€ã§ã™ï¼ #æ¡œè¯æ°´ç¥ç±¤`;
    const url = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(location.href)}`;
    document.getElementById('tweetBtn').href = url;

    // ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    card.style.display = 'none'; // ãƒªã‚»ãƒƒãƒˆ
    setTimeout(() => {
        card.style.display = 'block';
        requestAnimationFrame(() => card.classList.add('show'));
    }, 10);
    
    // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
    setTimeout(() => {
        card.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }, 100);
  });
</script>

</body>
</html>
